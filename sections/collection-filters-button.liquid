{% if collection.metafields.custom.filter_chips.value.filter_name != blank %}

  {% style %}
    .filter-buttons-container {
      padding: 0 15px;
    }
    filters-button {
      position: relative;
      display: block;
      overflow: auto;
      margin-bottom: 30px;
    }
    filters-button.updating button {
      pointer-events: none;
    }
    filters-button .updating {
      position: absolute;
      left: 0;
      top: 0;
      background-color: rgb(255 255 255 / 50%);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }
    .filter-buttons-list {
      display: table;
      width: max-content;
      border-collapse: collapse;
      margin: 0 auto;
    }
    .custom-filter-item {
      display: table-cell;
      padding-left: 20px;
    }
    .custom-filter-item:first-child {
      padding-left: 0;
    }
    .custom-filter-item button,
    .custom-filter-item a {
      cursor: pointer;
      color: #4e584a;
      text-align: center;
      font-size: 14px;
      font-weight: 500;
      line-height: 15px;
      text-transform: uppercase;
      border-radius: 100px;
      opacity: .5;
      border: 2px solid #4e584a;
      background-color: #fff;
      padding: 12px 15px;
      transition: all 0.3s;
    }
    .custom-filter-item button.active,
    .custom-filter-item button:hover,
    .custom-filter-item a:hover {
      opacity: 1;
      transition: all 0.3s;
    }
    .custom-filter-item button:disabled {
      opacity: .2;
      pointer-events: none;
    }
    @media(max-width: 768px) {
      filters-button {
        padding-bottom: 9px;
      }
      .custom-filter-item {
        padding-left: 10px;
      }
      .custom-filter-item button {
        font-size: 12px;
        font-weight: 400;
        padding: 9px 10px;
        line-height: 15px;
      }
      filters-button {
        margin-bottom: 15px;
      }
    }
  {% endstyle %}
  {% comment %} -- sdf {{ collection.metafields.custom.filter_chips.value.filter_name }} {% endcomment %}

  <div class="filter-buttons-container">

    <filters-button>
      <div class="js-filter-buttons-list filter-buttons-list"></div>
    </filters-button>

  </div>


  <script>

      class FiltersButton extends HTMLElement {
          constructor() {
              super();

              this.filtersArray = {{ collection.metafields.custom.filter_chips.value.filter_name }}
              this.filterButtonsList = this.querySelector('.js-filter-buttons-list')
          }
          connectedCallback() {

                this.renderFilterButtons()

                this.observeFacetFilters()

          }


          renderFilterButtons(){
            if(!this.filtersArray.length) return

            const fragmentItemProduct = document.createDocumentFragment();

            this.filtersArray.forEach((item,index) => {
               
       
              if(item.includes(':')){
                
                const buttonElement = document.createElement('div')
                  buttonElement.className = 'custom-filter-item';

                 const splitUtl = item.split(':');
                 if(splitUtl.length === 2){
                  buttonElement.innerHTML += `
                    <a href="${splitUtl[1]}" class="">${splitUtl[0]}</a>
                  `;
                 }
                 if(splitUtl.length === 3){
                  buttonElement.innerHTML += `
                    <a href="${splitUtl[2]}" class="">${splitUtl[0]}</a>
                  `;
                 }

                  fragmentItemProduct.appendChild(buttonElement)

              }else{
                const itemFilter = document.querySelector(`facet-filters-form input[value="${item}"]`)
                if(itemFilter){

                  const buttonElement = document.createElement('div')
                  buttonElement.className = 'custom-filter-item';

                  const currentIndex = index + 1
                    let isActive = false
                    let isDisabled = false
                    if (itemFilter.checked) isActive = true
                    if (itemFilter.disabled) isDisabled = true

                    buttonElement.innerHTML += `
                      <button data-value="${itemFilter.value}" class="${isActive ? 'active' : ''}" ${isDisabled ? 'disabled' : ''}>${itemFilter.value}</button>
                    `
                    fragmentItemProduct.appendChild(buttonElement)
                }
              }

              

            })



            this.filterButtonsList.innerHTML = '';
            this.filterButtonsList.appendChild(fragmentItemProduct)

            //loading effect
            this.loadingEffect()

            //run change logic
            this.changeFilterButtons();

          }



          changeFilterButtons(){

              this.querySelectorAll('.custom-filter-item button').forEach(item => {
                item.addEventListener('click', (e) => {
                  e.preventDefault();
                  
                  const currentFIlterCheckbox = document.querySelector(`facet-filters-form input[value="${e.currentTarget.dataset.value}"]`)
                  
                  if(currentFIlterCheckbox.checked){
                    currentFIlterCheckbox.click();
                    e.currentTarget.classList.remove('active')
                   

                  }else{
                    currentFIlterCheckbox.click();
                    e.currentTarget.classList.add('active')

                  }
                  this.classList.add('updating')

                })
              })
          }


          loadingEffect(){
            const createTextElement = document.createElement('div')
            createTextElement.textContent = ''
            createTextElement.className = 'updating'
            this.classList.add('updating')
              this.appendChild(createTextElement)
              setTimeout(()=>{
                createTextElement.remove()
                this.classList.remove('updating')
              },1000)
          }

          observeFacetFilters() {
            const target = document.querySelector('#FacetFiltersFormMobile collapsible-row');
            if (!target) return;

            const observer = new MutationObserver((mutationsList) => {
           
              for (const mutation of mutationsList) {
                if (mutation.type === 'childList' || mutation.type === 'attributes') {
                 
                  this.renderFilterButtons()
                }
              }
            });

            observer.observe(target, {
              childList: true,       
              subtree: false,         
              attributes: false      
            });

            this.facetFiltersObserver = observer;
          }

      }


      document.addEventListener("DOMContentLoaded", function() {
          
          if (!customElements.get('filters-button')) {
            customElements.define('filters-button', FiltersButton);
          }
      })


  </script>
{% endif %}

{% schema %}
  {
    "name": "Filters chips",
    "settings": [],
    "presets": [
      {
        "name": "Filters chips"
      }
    ]
  }
{% endschema %}